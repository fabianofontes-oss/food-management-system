SuperAdmin Destructive Operations:

=== HARD DELETE OPERATIONS ===

1. src\lib\superadmin\actions.ts:128-130
   Function: removeStoreOwnerAction
   Operation: DELETE from store_users
   Code:
     .delete()
     .eq('store_id', storeId)
     .eq('user_id', userId)
   Auth: ‚úÖ isSuperAdmin check (line 121)
   Guard Rails: ‚ùå No confirmation, no cooldown

2. src\lib\superadmin\actions.ts:162-165
   Function: deleteStoreAction
   Operation: DELETE from stores (CASCADE to all related data)
   Code:
     .delete()
     .eq('id', storeId)
   Auth: ‚úÖ isSuperAdmin check (line 156)
   Guard Rails: ‚ùå No confirmation, no cooldown, no soft delete
   Impact: üî¥ CRITICAL - Deletes products, orders, customers, etc.

3. src\lib\superadmin\actions.ts:198-201
   Function: deleteTenantAction
   Operation: DELETE from tenants (CASCADE to all stores and data)
   Code:
     .delete()
     .eq('id', tenantId)
   Auth: ‚úÖ isSuperAdmin check (line 192)
   Guard Rails: ‚ùå No confirmation, no cooldown, no soft delete
   Impact: üî¥ CRITICAL - Deletes entire tenant with all stores

4. src\lib\superadmin\users.ts:128-131
   Function: deleteUser
   Operation: DELETE from users (CASCADE to store_users)
   Code:
     .delete()
     .eq('id', userId)
   Auth: ‚ö†Ô∏è NOT VERIFIED in this function (caller must check)
   Guard Rails: ‚ùå No confirmation

5. src\lib\superadmin\queries.ts:114-117
   Function: deleteTenant
   Operation: DELETE from tenants
   Code:
     .delete()
     .eq('id', id)
   Auth: ‚ö†Ô∏è NOT VERIFIED in this function
   Guard Rails: ‚ùå None

6. src\lib\superadmin\queries.ts:175-178
   Function: deleteStore
   Operation: DELETE from stores
   Code:
     .delete()
     .eq('id', id)
   Auth: ‚ö†Ô∏è NOT VERIFIED in this function
   Guard Rails: ‚ùå None

7. src\lib\superadmin\plans.ts:103-106
   Function: deletePlan
   Operation: DELETE from plans
   Code:
     .delete()
     .eq('id', id)
   Auth: ‚ö†Ô∏è NOT VERIFIED in this function
   Guard Rails: ‚ùå None

=== SUSPENSION OPERATIONS ===

8. src\app\api\cron\billing\route.ts:73-82
   Function: Cron Job - Suspend overdue tenants
   Operation: UPDATE tenants SET status='suspended'
   Code:
     .update({
       status: 'suspended',
       suspended_at: new Date().toISOString(),
       suspended_reason: 'Fatura vencida - suspens√£o autom√°tica'
     })
   Auth: ‚úÖ CRON_SECRET check (line 21)
   Guard Rails: ‚úÖ Grace period (configurable)
   Impact: üü° MEDIUM - Automated suspension

9. src\app\api\cron\billing\route.ts:92-101
   Function: Cron Job - Expire trials
   Operation: UPDATE tenants SET status='suspended'
   Code:
     .update({
       status: 'suspended',
       suspended_at: new Date().toISOString(),
       suspended_reason: 'Trial expirado'
     })
   Auth: ‚úÖ CRON_SECRET check
   Guard Rails: ‚úÖ Automated based on trial_ends_at
   Impact: üü° MEDIUM - Automated trial expiration

=== CLIENT-SIDE DELETE HANDLERS ===

10. src\app\(super-admin)\admin\stores\page.tsx:157-159
    Function: handleDelete (client component)
    Code:
      if (!confirm(`Tem certeza que deseja excluir a loja "${name}"? Esta a√ß√£o n√£o pode ser desfeita.`)) return
    Guard Rails: ‚ö†Ô∏è Only browser confirm() - easily bypassed
    Calls: deleteStoreAction (server action)

11. src\app\(super-admin)\admin\users\page.tsx:222
    Function: handleDelete (client component)
    Guard Rails: ‚ö†Ô∏è Likely browser confirm() only
    Calls: deleteUser function

=== BULK DELETE OPERATIONS (Health/Builder) ===

12. src\app\(super-admin)\admin\health\builder\page.tsx:89-91
    Function: Clear store data before applying template
    Operations:
      - DELETE from products WHERE store_id
      - DELETE from categories WHERE store_id
    Auth: ‚ö†Ô∏è Client-side only (no server-side check visible)
    Guard Rails: ‚ùå No confirmation in code shown

13. src\app\(super-admin)\admin\health\builder\page.tsx:187-190
    Function: Clean store (delete all data)
    Operations:
      - DELETE from order_items
      - DELETE from orders
      - DELETE from products
      - DELETE from categories
    Auth: ‚ö†Ô∏è Client-side only
    Guard Rails: ‚ö†Ô∏è deleteConfirm state (must type confirmation?)

=== DRAFT CLEANUP (AUTOMATED) ===

14. src\app\api\cron\clean-expired-drafts\route.ts:27-31
    Function: Clean expired drafts
    Operation: DELETE from draft_stores WHERE expires_at < NOW()
    Auth: ‚úÖ CRON_SECRET check (line 19)
    Guard Rails: ‚úÖ Automated, only deletes expired
    Impact: üü¢ LOW - Cleanup of temporary data

=== SUMMARY ===

CRITICAL OPERATIONS (No Guard Rails):
- deleteTenantAction: Deletes entire tenant + all stores + all data
- deleteStoreAction: Deletes store + products + orders + customers
- removeStoreOwnerAction: Removes ownership (can lock out users)

MISSING PROTECTIONS:
‚ùå No confirmation beyond browser confirm()
‚ùå No cooldown period
‚ùå No "type name to confirm"
‚ùå No soft delete (deleted_at column)
‚ùå No audit log of deletions
‚ùå No two-person rule
‚ùå No step-up authentication
‚ùå No backup/export before delete

AUTHORIZATION GAPS:
‚ö†Ô∏è Some functions (queries.ts, plans.ts, users.ts) don't verify isSuperAdmin
‚ö†Ô∏è Rely on caller to check authorization
‚ö†Ô∏è Client components can call server actions directly
