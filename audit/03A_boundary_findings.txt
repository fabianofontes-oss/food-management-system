ETAPA 3A - Code Boundary / Imports Suspeitos
Data: 2024-12-19
Commit: d410642

===================================================================
IMPORTS SUSPEITOS EM CLIENT COMPONENTS
===================================================================

üî¥ CR√çTICO - Client Component importando queries privilegiadas diretamente:

1. src/modules/admin/tenants/hooks/useTenantsController.ts:1
   'use client'
   -> LINHA 4: import { getTenants, createTenant, updateTenant, deleteTenant, type Tenant, createClient } from '@/lib/superadmin/queries'
   -> LINHA 5: import { getAllPlans, getAllTenantsWithPlans, setTenantPlan, type Plan } from '@/lib/superadmin/plans'
   
   RISCO: Hook client executando queries de admin diretamente
   OPERA√á√ïES: getTenants(), createTenant(), updateTenant(), deleteTenant()
   IMPACTO: üî¥ CR√çTICO - Muta√ß√µes privilegiadas no client
   A√á√ÉO: Mover para Server Actions

---

üü° M√âDIO - Client Components importando types de m√≥dulos admin:

2. src/modules/admin/tenants/types/tenant.types.ts:1-2
   -> import { type Tenant } from '@/lib/superadmin/queries'
   -> import { type Plan } from '@/lib/superadmin/plans'
   
   RISCO: Apenas types (n√£o executa c√≥digo)
   IMPACTO: üü¢ BAIXO - Types s√£o seguros
   A√á√ÉO: Nenhuma (types s√£o stripped no build)

---

üü¢ SEGURO - Server Components importando m√≥dulos admin:

3. app/(super-admin)/admin/billing/page.tsx:11
   (SEM 'use client')
   -> import { createClient } from '@/lib/superadmin/queries'
   
   RISCO: Nenhum (Server Component)
   IMPACTO: ‚úÖ SEGURO
   A√á√ÉO: Nenhuma

4. app/(super-admin)/admin/page.tsx:13
   (SEM 'use client')
   -> import { getTenantsCount, getStoresCount, getRecentStores, type StoreWithTenant, createClient } from '@/lib/superadmin/queries'
   
   RISCO: Nenhum (Server Component)
   IMPACTO: ‚úÖ SEGURO
   A√á√ÉO: Nenhuma

5. app/(super-admin)/admin/stores/page.tsx:7-8
   (SEM 'use client')
   -> import { getStores, createStore, updateStore, getTenants, type StoreWithTenant, type Tenant } from '@/lib/superadmin/queries'
   -> import { deleteStoreAction } from '@/lib/superadmin/actions'
   
   RISCO: Nenhum (Server Component)
   IMPACTO: ‚úÖ SEGURO
   A√á√ÉO: Nenhuma

6. app/(super-admin)/admin/plans/page.tsx:8
   (SEM 'use client')
   -> import { getAllPlans, formatPrice, type Plan } from '@/lib/superadmin/plans'
   
   RISCO: Nenhum (Server Component)
   IMPACTO: ‚úÖ SEGURO
   A√á√ÉO: Nenhuma

7. app/(super-admin)/admin/plans/[planId]/page.tsx:9
   (SEM 'use client')
   -> import { getPlanById, updatePlan, getTenantsByPlan, type Plan } from '@/lib/superadmin/plans'
   
   RISCO: Nenhum (Server Component)
   IMPACTO: ‚úÖ SEGURO
   A√á√ÉO: Nenhuma

8. app/(super-admin)/admin/plans/new/page.tsx:9
   (SEM 'use client')
   -> import { createPlan } from '@/lib/superadmin/plans'
   
   RISCO: Nenhum (Server Component)
   IMPACTO: ‚úÖ SEGURO
   A√á√ÉO: Nenhuma

---

‚úÖ SEGURO - Server Components/Actions importando repositories:

9. app/[slug]/page.tsx:9
   (SEM 'use client')
   -> import { MinisiteRepository } from '@/modules/minisite/repository'
   
   RISCO: Nenhum (Server Component)
   IMPACTO: ‚úÖ SEGURO
   A√á√ÉO: Nenhuma

10. app/api/onboarding/publish-draft/route.ts:3
    (API Route Handler - server-only)
    -> import { draftStoreRepository } from '@/modules/draft-store'
    
    RISCO: Nenhum (API Route)
    IMPACTO: ‚úÖ SEGURO
    A√á√ÉO: Nenhuma

---

‚ö†Ô∏è ATEN√á√ÉO - Men√ß√µes em texto (n√£o c√≥digo execut√°vel):

11. app/[slug]/dashboard/team/page.tsx:202
    (Texto em JSX)
    -> <li>Adicione SUPABASE_SERVICE_ROLE_KEY nas vari√°veis de ambiente do Vercel</li>
    
    RISCO: Nenhum (apenas string)
    IMPACTO: ‚úÖ SEGURO
    A√á√ÉO: Nenhuma

12. app/[slug]/dashboard/team/actions.ts:72
    (Server Action - 'use server')
    -> return { error: 'Convite por email n√£o est√° dispon√≠vel. Configure SUPABASE_SERVICE_ROLE_KEY para habilitar.' }
    
    RISCO: Nenhum (apenas string)
    IMPACTO: ‚úÖ SEGURO
    A√á√ÉO: Nenhuma

===================================================================
RESUMO DE FINDINGS
===================================================================

Total de arquivos analisados: ~150 client components
Imports suspeitos encontrados: 12 ocorr√™ncias

CLASSIFICA√á√ÉO:
- üî¥ CR√çTICO (requer corre√ß√£o imediata): 1
  - useTenantsController.ts importando queries privilegiadas

- üü° M√âDIO (aten√ß√£o mas seguro): 1
  - tenant.types.ts importando types (stripped no build)

- üü¢ SEGURO (server components/routes): 10
  - Todos os outros imports est√£o em server components ou API routes

A√á√ÉO REQUERIDA:
1. Corrigir useTenantsController.ts movendo opera√ß√µes para Server Actions
2. Adicionar 'server-only' em m√≥dulos privilegiados (defesa em profundidade)
3. Rodar build scan para confirmar que nada vazou para o bundle do cliente

===================================================================
FIM DO RELAT√ìRIO DE FINDINGS
===================================================================
