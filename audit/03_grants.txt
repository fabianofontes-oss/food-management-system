ETAPA 3 - Grants para anon/authenticated
Data: 2024-12-19
Query: SELECT grantee, table_schema, table_name, privilege_type FROM information_schema.role_table_grants WHERE table_schema = 'public' AND grantee IN ('anon','authenticated')

========================================
RESULTADO DA QUERY 3.3 (RESUMIDO)
========================================

Total de grants: 210 (anon: 105, authenticated: 105)

üî¥ CR√çTICO - Grants para 'anon' em TODAS as tabelas:

Tabela                  | Privileges para anon
------------------------|---------------------
categories              | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
customers               | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
draft_stores            | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
invoices                | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER  üî¥ CR√çTICO
order_items             | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
orders                  | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
payment_history         | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER  üî¥ CR√çTICO
plans                   | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
products                | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
slug_reservations       | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
store_users             | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER  üî¥ CR√çTICO
stores                  | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER
tenant_subscriptions    | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER  üî¥ CR√çTICO
tenants                 | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER  üî¥ CR√çTICO
users                   | SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER  üî¥ CR√çTICO

========================================
AN√ÅLISE DE GRANTS
========================================

üî¥ CR√çTICO - Tabelas sens√≠veis com grants para 'anon':
1. tenants - ALL privileges (SELECT, INSERT, UPDATE, DELETE)
2. invoices - ALL privileges
3. payment_history - ALL privileges
4. tenant_subscriptions - ALL privileges
5. users - ALL privileges
6. store_users - ALL privileges
7. stores - ALL privileges
8. orders - ALL privileges
9. order_items - ALL privileges
10. products - ALL privileges
11. categories - ALL privileges
12. customers - ALL privileges

üü° JUSTIFIC√ÅVEL - Tabelas de onboarding com grants para 'anon':
1. draft_stores - Necess√°rio para onboarding p√∫blico
2. plans - Necess√°rio para visualiza√ß√£o de planos
3. slug_reservations - Necess√°rio para reserva de slugs

‚úÖ OK - Grants para 'authenticated':
- Todas as tabelas t√™m grants apropriados para authenticated
- Protegidos por policies de RLS

IMPACTO:
Embora as policies de RLS estejam protegendo os dados, os grants excessivos para 'anon' violam o princ√≠pio do menor privil√©gio e ampliam a superf√≠cie de ataque. Se houver qualquer falha nas policies ou bypass de RLS, 'anon' ter√° acesso total ao banco.
