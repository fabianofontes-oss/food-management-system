Middleware Billing/Subscription Enforcement Analysis:

=== CURRENT MIDDLEWARE ===
File: src\middleware.ts (18 lines total)
File: src\lib\supabase\middleware.ts (110 lines total)

=== MIDDLEWARE CHECKS IMPLEMENTED ===
‚úÖ Authentication check (user logged in)
‚úÖ Store access check (user belongs to store via store_users)
‚úÖ Demo mode bypass (slug === 'demo' or settings.isDemo)
‚úÖ Public routes allowed

=== MIDDLEWARE CHECKS MISSING ===
‚ùå NO tenant status check (active/suspended/trial_expired)
‚ùå NO subscription status check
‚ùå NO trial_ends_at validation
‚ùå NO billing status check (past_due/unpaid)
‚ùå NO grace period logic

=== EVIDENCE: src\lib\supabase\middleware.ts ===

Lines 59-106: Dashboard access control
- Checks if user is authenticated (line 90-92)
- Checks if user has access to store (line 95-105)
- DOES NOT check tenant.status
- DOES NOT check tenant.trial_ends_at
- DOES NOT check subscription status

Example of missing check:
```typescript
// Line 71-80: Busca store mas n√£o busca tenant
const { data: store, error: storeError } = await supabase
  .from('stores')
  .select('id, settings')  // ‚ö†Ô∏è N√£o busca tenant_id ou tenant.status
  .eq('slug', slug)
  .single()

// MISSING: Check tenant status
// const { data: tenant } = await supabase
//   .from('tenants')
//   .select('status, trial_ends_at')
//   .eq('id', store.tenant_id)
//   .single()
//
// if (tenant.status === 'suspended' || tenant.status === 'cancelled') {
//   return NextResponse.redirect(new URL('/billing/suspended', request.url))
// }
```

=== CONCLUSION ===
üî¥ CRITICAL: Middleware does NOT enforce billing/subscription status
üî¥ CRITICAL: Trial expiration is only enforced by cron job (not real-time)
üî¥ CRITICAL: Suspended tenants can still access dashboard until next cron run

VULNERABILITY: "Trial Infinito"
- User can access dashboard even after trial expires
- Only blocked when cron job runs (may be hours/days later)
- No real-time enforcement at request time
